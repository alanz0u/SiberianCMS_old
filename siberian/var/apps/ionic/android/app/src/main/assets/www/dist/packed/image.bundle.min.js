angular.module("starter").controller("ImageListController",function($scope,$stateParams,$timeout,$translate,$window,$q,Url,Image,Lightbox,Loader){angular.extend($scope,{is_loading:!1,can_load_more:!1,images:[],collection:[],show_galleries:!1,value_id:$stateParams.value_id,card_design:!1}),Image.setValueId($stateParams.value_id),$scope.loadContent=function(refresh){$scope.is_loading=!0,Loader.show($translate.instant("Loading...","media")),Image.findAll(refresh).then(function(data){$scope.galleries=data.galleries,$scope.page_title=data.page_title,$scope.galleries.length?$scope.showGallery($scope.galleries[0]):($scope.is_loading=!0,Loader.hide())})},$scope.listDidRender=function(){$timeout(function(){Lightbox.run(".media-images-gallery")},200)},$scope.imagePath=function(src){return src},$scope.showGallery=function(gallery){$scope.show_galleries=!1,$scope.button_label=gallery.name,$scope.current_gallery&&$scope.current_gallery.id===gallery.id||($scope.is_loading=!0,$scope.collection=[],$scope.current_gallery=gallery,$scope.loadGallery().then(function(){$scope.is_loading=!1,Loader.hide()}))},$scope.loadGallery=function(){var defer=$q.defer(),offset=0;switch($scope.collection.length&&(offset=$scope.collection.length),0===offset&&Loader.show($translate.instant("Loading...","media")),$scope.loadPage=!1!==$scope.current_gallery.nextPage?$scope.current_gallery.nextPage:$scope.current_gallery.currentPage,$scope.current_gallery.type){case"facebook":Image.findFacebook($scope.current_gallery,$scope.loadPage).then(function(data){for(var i=0;i<data.collection.length;i+=1)$scope.collection.push(data.collection[i]);$scope.can_load_more=!!data.nextPage,$scope.current_gallery.currentPage=data.currentPage,$scope.current_gallery.nextPage=data.nextPage}).then(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),defer.resolve()});break;default:Image.find($scope.current_gallery,offset).then(function(data){for(var i=0;i<data.collection.length;i+=1)$scope.collection.push(data.collection[i]);$scope.can_load_more=data.collection.length>0&&data.show_load_more}).then(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),defer.resolve()})}return defer.promise},$scope.toggleGalleries=function(){$scope.show_galleries=!$scope.show_galleries},isOverview&&($window.overview.features.image={loadContent:function(){$scope.loadContent(!0)}}),$scope.loadContent()}),angular.module("starter").factory("Image",function($pwaRequest){var factory={value_id:null,displayed_per_page:0,extendedOptions:{},setValueId:function(value_id){factory.value_id=value_id},setExtendedOptions:function(options){factory.extendedOptions=options},findAll:function(refresh){if(!this.value_id)return $pwaRequest.reject("[Factory::Image.findAll] missing value_id");if(!(void 0!==refresh&&refresh)){var payload=$pwaRequest.getPayloadForValueId(factory.value_id);if(!1!==payload)return $pwaRequest.resolve(payload)}return $pwaRequest.get("media/mobile_gallery_image_list/findall",angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions))},find:function(item,offset){return this.value_id?$pwaRequest.get("media/mobile_gallery_image_view/find",{urlParams:{value_id:this.value_id,gallery_id:item.id,offset:offset}}):$pwaRequest.reject("[Factory::Image.find] missing value_id")},findFacebook:function(item,albumUrl){var localAlbumUrl=albumUrl;return"string"==typeof localAlbumUrl&&(localAlbumUrl=encodeURIComponent(btoa(localAlbumUrl))),$pwaRequest.get("media/mobile_gallery_image_view/findfacebook",{urlParams:{value_id:this.value_id,album_url:localAlbumUrl,gallery_id:item.id}})}};return factory});